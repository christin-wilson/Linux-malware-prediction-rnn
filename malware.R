rm(list=ls())

#Date: Oct 22th, 2018
#Purpose: Analysis of Linux Malware Data

library(randomForest)
library(caret) # Accuracy
library(ggplot2)
library(ROCR)
library(C50)
library(rpart)
library(rpart.plot)
library(rattle)
library(caTools)
library(e1071)

df3 <- read.csv(file="C:/Users/Shivam Pandit/Desktop/Malware data/Malware analysis/cleandata.csv", header=TRUE, sep=",")

sum(is.na(df3))
summary(testdf3)

names(testdf3)

testdf3 <- subset( df3, select = -c(vt.positives))
names(testdf3)
testdf3$Malware <- as.factor(testdf3$Malware)
#########################################################
# Sampling the dataset based on best variables
#############################################################
#splitdata<- sample.split(testdf3,SplitRatio = 0.7)
#traindata <- subset(testdf3, splitdata == TRUE)
#testdata <- subset(testdf3, splitdata == FALSE)

#Splitting based on RNNs test and train data
traindataf <- subset(testdf3, test_set == FALSE)
testdataf <- subset(testdf3, test_set == TRUE)

traindata <- subset( traindataf, select = -c(test_set))
testdata <- subset( testdataf, select = -c(test_set))

names(traindata)
set.seed(3233)
################################################
#Implementing KNN
#####################################################
dfcla.knn <- knn3(Malware~.,traindata)
dfcla.knn.pred <- predict( dfcla.knn,testdata,type="class")
dfcla.knn.prob <- predict( dfcla.knn,testdata,type="prob")

# Confusion matrix
confusionMatrix(dfcla.knn.pred, testdata$Malware)

##########################################################
###       Implementing CART
#########################################################

# Classification and Regression Trees
news.cart<-rpart(Malware ~.,testdata,method='class')


fancyRpartPlot(news.cart, digits=2)

#predict
cart_pred<-predict( news.cart,testdata ,type="class")
cart_prob<-predict( news.cart,testdata ,type="prob")

# Confusion matrix
confusionMatrix(cart_pred, testdata$Malware)

################################
##Implementing Random Forest
###############################
malware.rf<-randomForest(Malware ~.,traindata,
                         ntree=100,nPerm=10,mtry=3,proximity=TRUE,importance=TRUE)
"Summary of Ramdom Forest"

plot(malware.rf,main="Error Rate in Random Forest")

malware.rf.pred<-predict( malware.rf,testdata, type="class")
malware.rf.prob<-predict( malware.rf,testdata, type="prob")
# Confusion matrix
confusionMatrix(malware.rf.pred, testdata$Malware)

#########################################
#Implememnting SVM(Support Vector Machine)
#########################################


trctrl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
malware_svm <- train(Malware ~., data = traindata, method = "svmLinear",
                     trControl=trctrl,
                     preProcess = c("center", "scale"),
                     tuneLength = 10)
malware_svm_pred <- predict(malware_svm, newdata = testdata)

summary(malware_svm_pred)

confusionMatrix(malware_svm_pred, testdata$Malware )


##############################
#Implementing Naive bayes 
###############################
nav.mod <- naiveBayes(Malware~.,traindata)
#pred <- predict(nav.mod,testdata)
nb.pred<-predict(nav.mod,testdata,type="class" )
nb.prob<-predict(nav.mod,testdata,type="raw" )

confusionMatrix(nb.pred,testdata$Malware)

